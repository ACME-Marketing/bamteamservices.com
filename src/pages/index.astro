---
import BaseLayout from '../layouts/BaseLayout.astro';
import { graphQLClient, gql } from '../lib/graphql';

const GET_BAMTEAMSERVICES_POSTS = gql`
  query GetBamteamservicesPosts {
    posts(where: { categoryNameIn: ["bam-team", "all"] }) {
      nodes {
        title
        uri
        categories {
          nodes {
            name
          }
        }
      }
    }
  }
`;

let posts = [];
try {
  const data = await graphQLClient.request(GET_BAMTEAMSERVICES_POSTS);
  posts = data.posts.nodes;
} catch (error) {
  console.error("Error fetching posts for bamteamservices.com:", error);
}
---

<BaseLayout title="BAM Team Services - Blog">
	<header>
		<h1>Welcome to BAM Team Services Blog</h1>
	</header>

	<main class="container">
		{posts.length > 0 ? (
			<ul>
				{posts.map((post) => (
					<li>
						<a href={post.uri}>{post.title}</a>
						{post.categories && post.categories.nodes.length > 0 && (
							<span> ({post.categories.nodes.map(cat => cat.name).join(', ')})</span>
						)}
					</li>
				))}
			</ul>
		) : (
			<p>No posts found. Please add some posts in your WordPress CMS with the category "BAM Team Services Insights" or "all".</p>
		)}
	</main>

	<footer>
		<p>&copy; {new Date().getFullYear()} BAM Team Services. All rights reserved.</p>
	</footer>
</BaseLayout>